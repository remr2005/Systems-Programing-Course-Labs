# Лабораторная работа № 5
## Исследование взаимодействия с портами ввода-вывода

### Описание
Лабораторная работа по программированию микропроцессора КР580 (аналог Intel 8080) для работы с портами ввода-вывода через программируемый интерфейс КР580ИК55.

### Структура файлов

1. **zadanie1_peredacha_dannyh.txt** - Передача данных из порта ввода в порт вывода
2. **zadanie2_logicheskie_operacii.txt** - Логические операции (И, ИЛИ, XOR)
3. **zadanie3_maskirovanie.txt** - Маскирование битов
4. **zadanie4_begushchie_ogni.txt** - Бегущие огни с командами сдвига
5. **zadanie5_slozhnye_begushchie_ogni.txt** - Сложные бегущие огни с задержками

### Настройка интерфейса КР580ИК55

**Адреса портов:**
- Порт A (ввод): `FAh`
- Порт B (вывод): `F9h`
- Регистр управления: `FBh`

**Код управления:** `81h` (10000001b)
- Порт A - режим ввода
- Порт B - режим вывода
- Порт C - не используется

### Инструкция по использованию в эмуляторе КАКРМ

#### Общие шаги:
1. Откройте эмулятор КАКРМ
2. Загрузите программу в память начиная с адреса `8000h`
3. Установите начальный адрес `8000h`
4. Нажмите кнопку **ПУСК** для запуска программы
5. Нажмите кнопку **СБРОС** для остановки программы

#### Формат ввода программ:
Программы представлены в двух форматах:
- **Строка с кодами:** `8000: 3E 81 D3 FB ...` - можно скопировать целиком
- **Построчно:** каждый адрес с соответствующим кодом

### Задание 1: Передача данных

**Цель:** Передача данных из порта ввода (тумблеры) в порт вывода (светодиоды)

**Действия:**
1. Введите программу из файла `zadanie1_peredacha_dannyh.txt`
2. Запустите программу с адреса `8000h`
3. Измените положение тумблеров порта ввода
4. Наблюдайте изменение состояния светодиодов 2-4 (справа)
5. Нажмите СБРОС - программа остановится

**Ожидаемый результат:** Состояние светодиодов соответствует положению тумблеров

---

### Задание 2: Логические операции

**Цель:** Демонстрация работы логических команд (И, ИЛИ, XOR)

**Действия:**
1. Введите программу с операцией И (ANA B) - код `A0` по адресу `8008`
2. Запустите программу
3. Установите все переключатели в 1
4. Наблюдайте результат: индикаторы покажут `00001010` (0Ah)
5. Измените переключатели и проверьте выходы
6. Замените команду `A0` на `B0` (ORA B) - операция ИЛИ
7. Запустите программу снова и проанализируйте результаты
8. Замените команду `B0` на `A8` (XRA B) - операция XOR
9. Повторите анализ

**Ожидаемые результаты:**
- **И (ANA):** Биты, объединенные с нулями, всегда дают 0
- **ИЛИ (ORA):** Биты, объединенные с единицами, всегда дают 1
- **XOR (XRA):** Биты инвертируются там, где в маске стоит 1

---

### Задание 3: Маскирование

**Цель:** Проверка состояния отдельного бита входного порта

**Действия:**
1. Введите программу из файла `zadanie3_maskirovanie.txt`
2. Запустите программу
3. Проверьте работу второго переключателя (бит 2)
4. Все индикаторы должны загораться только при включенном втором переключателе
5. Измените маску для проверки другого переключателя:
   - Бит 0: замените `04` на `01` по адресу `8007`
   - Бит 1: замените `04` на `02` по адресу `8007`
   - Бит 2: оставьте `04` (текущий)

**Ожидаемый результат:** Индикаторы реагируют только на выбранный переключатель

---

### Задание 4: Бегущие огни

**Цель:** Реализация эффекта "бегущего огня" с использованием команд сдвига

**Действия:**
1. Введите программу из файла `zadanie4_begushchie_ogni.txt`
2. Запустите программу
3. Наблюдайте эффект "бегущего огня" вправо
4. Замените команду `RRC` (0F) на `RLC` (07) по адресу `8014`
5. Запустите программу - огонь будет бежать влево
6. Измените частоту переключения, изменив значение по адресу `8007` (регистр D)
7. Измените начальную комбинацию, изменив значение по адресу `8005` (регистр A)

**Ожидаемый результат:** Визуальный эффект перемещающегося светового сигнала

**Команды сдвига:**
- `RRC` (0F) - сдвиг вправо через перенос
- `RLC` (07) - сдвиг влево через перенос

---

### Задание 5: Сложные бегущие огни

**Цель:** Реализация контроллера с последовательностью горения светодиодов

**Действия:**
1. Введите основную программу в память начиная с адреса `8000h`
2. Введите подпрограмму задержки начиная с адреса `8010h`
3. Проверьте правильность ввода
4. Запустите программу с адреса `8000h`
5. Наблюдайте последовательность:
   - Светодиоды 1, 4, 7 горят (код 92h)
   - Светодиоды 2, 5, 8 горят (код 49h)
   - Светодиоды 3, 6 горят (код 24h)
   - Цикл повторяется
6. Измените время задержки, изменив значения по адресам `8009`, `8012`, `801B`

**Ожидаемый результат:** Последовательное переключение групп светодиодов с заданными интервалами

**Комбинации светодиодов:**
| Код | Двоичный | Светодиоды |
|-----|----------|------------|
| 92h | 10010010 | 1, 4, 7    |
| 49h | 01001001 | 2, 5, 8    |
| 24h | 00100100 | 3, 6       |

---

### Технические детали

#### Команды микропроцессора КР580:

**Арифметические и логические:**
- `MVI A, nn` (3E nn) - загрузка константы в аккумулятор
- `MVI B, nn` (06 nn) - загрузка константы в регистр B
- `MVI D, nn` (16 nn) - загрузка константы в регистр D
- `MVI E, nn` (1E nn) - загрузка константы в регистр E
- `ANA B` (A0) - логическое И: A AND B → A
- `ORA B` (B0) - логическое ИЛИ: A OR B → A
- `XRA B` (A8) - логическое исключающее ИЛИ: A XOR B → A

**Операции сдвига:**
- `RRC` (0F) - сдвиг вправо через перенос
- `RLC` (07) - сдвиг влево через перенос

**Операции с портами:**
- `IN nn` (DB nn) - ввод из порта
- `OUT nn` (D3 nn) - вывод в порт

**Операции с регистрами:**
- `DCR A` (3D) - уменьшение аккумулятора на 1
- `DCR B` (05) - уменьшение регистра B на 1
- `DCR D` (15) - уменьшение регистра D на 1
- `DCR E` (1D) - уменьшение регистра E на 1
- `DCX B` (0B) - уменьшение пары регистров B,C на 1
- `MOV A, B` (78) - копирование B в A
- `ORA C` (B1) - логическое ИЛИ A и C

**Операции с памятью:**
- `LXI B, nnnn` (01 nn nn) - загрузка константы в пару регистров B,C

**Управление программой:**
- `JMP addr` (C3 nn nn) - безусловный переход
- `JZ addr` (CA nn nn) - переход если флаг Z=1 (результат = 0)
- `JNZ addr` (C2 nn nn) - переход если флаг Z=0 (результат ≠ 0)
- `CALL addr` (CD nn nn) - вызов подпрограммы
- `RET` (C9) - возврат из подпрограммы

#### Расчет времени задержки:

**Простая задержка (одна петля):**
```
Задержка = (A - 1) × 14 + 21 тактов
Задержка = (A - 1) × 7 мкс + 10.5 мкс
Максимум: 1795 мкс (при A = 0, что эквивалентно 256)
```

**Задержка с парами регистров:**
```
Задержка = (N - 1) × 24 + 31 тактов
Задержка = (N - 1) × 12 мкс + 15.5 мкс
Максимум: 0.786 секунды (при N = 65536)
```

**Вложенная задержка:**
```
Общая задержка = D × 0.786 секунды
Максимум: 201 секунда (при D = 255)
```

### Примечания

- Все адреса указаны в шестнадцатеричном формате
- Все коды команд и данных указаны в шестнадцатеричном формате
- Программы начинаются с адреса `8000h` (32768 в десятичной системе)
- При работе с эмулятором убедитесь, что порты правильно настроены
- Для изменения параметров программ используйте таблицы соответствия адресов и команд

### Отчет

При выполнении лабораторной работы занесите в отчет:
1. Листинги всех программ с комментариями
2. Результаты выполнения каждого задания
3. Анализ работы логических операций
4. Наблюдения за работой программ "бегущих огней"
5. Выводы по каждому заданию

